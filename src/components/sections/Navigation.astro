---
import TicketCTA from "../primitives/TicketCTA.astro"

export interface Props {
  currentPage?: string
}

const { currentPage } = Astro.props
---

<style>
  .mobile-menu {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
  }

  .mobile-menu.open {
    max-height: 500px;
  }

  .hamburger span {
    display: block;
    width: 25px;
    height: 2px;
    background-color: white;
    margin: 5px 0;
    transition: all 0.3s ease;
  }

  .hamburger.open span:nth-child(1) {
    transform: rotate(45deg) translate(7px, 7px);
  }

  .hamburger.open span:nth-child(2) {
    opacity: 0;
  }

  .hamburger.open span:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -7px);
  }
</style>

<script>
  window.addEventListener('astro:page-load', () => {
    const hamburger = document.getElementById('hamburger');
    const mobileMenu = document.getElementById('mobile-menu');

    const closeMenu = () => {
      hamburger?.classList.remove('open');
      mobileMenu?.classList.remove('open');
    };

    const handleHamburgerClick = (e: Event) => {
      e.stopPropagation();
      hamburger?.classList.toggle('open');
      mobileMenu?.classList.toggle('open');
    };

    // Close menu when clicking outside
    const handleDocumentClick = (e: Event) => {
      if (!e.target) return;
      
      const isMenuOpen = mobileMenu?.classList.contains('open');
      const clickedInsideMenu = mobileMenu?.contains(e.target as Node);
      const clickedHamburger = hamburger?.contains(e.target as Node);
      
      if (isMenuOpen && !clickedInsideMenu && !clickedHamburger) {
        closeMenu();
      }
    };

    // Close menu when pressing Escape key
    const handleKeydown = (e: KeyboardEvent) => {
      if (e.key === 'Escape' && mobileMenu?.classList.contains('open')) {
        closeMenu();
      }
    };

    hamburger?.addEventListener('click', handleHamburgerClick);

    // Close menu when clicking a link
    const mobileLinks = mobileMenu?.querySelectorAll('a');
    mobileLinks?.forEach(link => {
      link.addEventListener('click', closeMenu);
    });

    document.addEventListener('click', handleDocumentClick);
    document.addEventListener('keydown', handleKeydown);

    // Cleanup event listeners on page unload
    window.addEventListener('astro:before-swap', () => {
      hamburger?.removeEventListener('click', handleHamburgerClick);
      mobileLinks?.forEach(link => {
        link.removeEventListener('click', closeMenu);
      });
      document.removeEventListener('click', handleDocumentClick);
      document.removeEventListener('keydown', handleKeydown);
    }, { once: true });
  });
</script>

<nav
  class="sticky top-0 z-50 text-white py-6 bg-background/40 backdrop-blur-sm"
  style="view-transition-name: navbar;"
>
  <div class="mx-auto max-w-6xl px-6 lg:px-8">
    <div class="flex items-center justify-between">
      <a href="/" class="text-2xl font-bold font-mono"
        ><img src="/ba-logo.png" alt="Boating Accident Logo" class="w-42" /></a
      >

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-8 font-mono">
        <a
          href="/about"
          class={currentPage === "about"
            ? "text-white"
            : "hover:text-white transition-colors text-gray-400"}>About</a
        >
        <a
          href="/program"
          class={currentPage === "program"
            ? "text-white"
            : "hover:text-white transition-colors text-gray-400"}>Program</a
        >
        <TicketCTA />
      </div>

      <!-- Hamburger Menu Button -->
      <button
        id="hamburger"
        class="md:hidden hamburger focus:outline-none"
        aria-label="Toggle menu"
      >
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="mobile-menu md:hidden">
      <div class="flex flex-col space-y-4 pt-4 font-mono">
        <a
          href="/about"
          class={currentPage === "about"
            ? "text-white"
            : "hover:text-white transition-colors text-gray-400"}>About</a
        >
        <a
          href="/program"
          class={currentPage === "program"
            ? "text-white"
            : "hover:text-white transition-colors text-gray-400"}>Program</a
        >
        <div class="pt-2">
          <TicketCTA />
        </div>
      </div>
    </div>
  </div>
</nav>
